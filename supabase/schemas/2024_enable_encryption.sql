-- 2024_enable_encryption.sql\n\n-- 1. Enable pgcrypto and pgsodium extensions\ncreate extension if not exists pgcrypto;\ncreate extension if not exists pgsodium;\n\n-- 2. (Demo) Encrypt users.email using pgcrypto (use a secure key in production)\nupdate public.users set email = pgp_sym_encrypt(email, 'changeme_demo_key') where email is not null;\n\n-- 3. (Demo) Store a secret in Supabase Vault\n-- insert into vault.secrets (secret) values ('demo_api_key_123');\n-- (Note: Vault insert may require elevated permissions or API usage)\n\n-- 4. Document: Column-level encryption with pgsodium is not yet stable in Supabase managed Postgres. Use Vault for secrets and pgcrypto for column encryption.\n
