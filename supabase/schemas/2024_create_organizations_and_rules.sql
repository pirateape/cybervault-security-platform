-- Create organizations table with uuid PK\ncreate table if not exists public.organizations (\n  id uuid primary key default gen_random_uuid(),\n  name text not null,\n  slug text unique not null,\n  plan_type text not null check (plan_type in ('free', 'pro', 'enterprise')),\n  max_posts int not null default 5,\n  created_at timestamptz default now()\n);\n\n-- Create rules table with org_id as uuid FK\ncreate table if not exists public.rules (\n  id bigint primary key generated always as identity,\n  org_id uuid not null references public.organizations(id) on delete cascade,\n  name text not null,\n  description text,\n  severity text check (severity in ('low', 'medium', 'high')),\n  created_at timestamptz default now()\n);\n\n-- Ensure org_id columns are uuid and add FKs\nalter table if exists public.users\n  add column if not exists org_id uuid references public.organizations(id);\n\nalter table if exists public.scans\n  add column if not exists org_id uuid references public.organizations(id);\n\nalter table if exists public.results\n  add column if not exists org_id uuid references public.organizations(id);\n\nalter table if exists public.audit_logs\n  add column if not exists org_id uuid references public.organizations(id);\n\n-- Add indexes for performance\ncreate index if not exists idx_users_org_id on public.users(org_id);\ncreate index if not exists idx_scans_org_id on public.scans(org_id);\ncreate index if not exists idx_results_org_id on public.results(org_id);\ncreate index if not exists idx_audit_logs_org_id on public.audit_logs(org_id);\n\n-- Add foreign key constraints for org_id columns\nalter table if exists public.users\n  add constraint fk_users_org_id foreign key (org_id) references public.organizations(id);\nalter table if exists public.scans\n  add constraint fk_scans_org_id foreign key (org_id) references public.organizations(id);\nalter table if exists public.results\n  add constraint fk_results_org_id foreign key (org_id) references public.organizations(id);\nalter table if exists public.audit_logs\n  add constraint fk_audit_logs_org_id foreign key (org_id) references public.organizations(id);
